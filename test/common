#!/usr/bin/env bash

cwd="$(cd "$(dirname "$0")" && pwd)"

create () {
    image_id="$(cat "$cwd/../test_image_id")"
    docker create \
        --interactive \
        --entrypoint="$2" \
        "$image_id"
}

run () {
    container_id="$(create "$1" "$2")"
    docker start --interactive "$container_id" <<< "$3"
}

assert_runs_twice () {
    container_id="$(create "$1" "$2")"
    echo "Run 1"
    echo
    docker start --interactive "$container_id" <<< "$3"
    echo
    echo "Run 2"
    echo
    if docker start --interactive "$container_id" <<< "$3"
    then
        echo "Test passed"
    else
        echo "Test failed"
        exit 1
    fi
}

assert_equal_json () {
    comparable_expected_output="$(jq <<< "$1")"
    comparable_actual_output="$(jq <<< "$2")"
    if [ "$comparable_expected_output" == "$comparable_actual_output" ]
    then
        echo "Test passed"
    else
        echo "Test failed"
        echo
        echo "Expected output:"
        echo "$comparable_expected_output"
        echo
        echo "Actual output:"
        echo "$comparable_actual_output"
        echo
        exit 1
    fi
}

assert_equal () {
    if [ "$1" == "$2" ]
    then
        echo "Test passed"
    else
        echo "Test failed"
        echo
        echo "Expected output:"
        echo "$1"
        echo
        echo "Actual output:"
        echo "$2"
        echo
        exit 1
    fi
}
