#!/usr/bin/env bash

set -e

cwd="$(cd "$(dirname "$0")" && pwd)"
# shellcheck disable=SC1090
source "$cwd/common"

uri="git@github.com:boclips/backoffice.git"
private_key="$(bo show credential concourse-main boclips.backoffice repo-key)"
commit_with_149_version=870d3fd6bddc4d04f325e25b6eb3849f099e2565

it "echoes version"

assert_equal_json '
{
  version: { tag: "149", app: "backoffice" },
  metadata: [
    { name: "tag", value: "149" },
    { name: "app", value: "backoffice" }
  ]
}' \
    "$(run /opt/resource/in "$(
jq \
    --null-input \
    --arg uri "$uri" \
    --arg branch "$commit_with_149_version" \
    --arg private_key "$private_key" \
    '{
       source: {
         uri: $uri,
         branch: $branch,
         private_key: $private_key
       },
       version: {
         tag: "149",
         app: "backoffice"
       },
       params: {}
     }'
)")"
